<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>All Products</title>
  <link rel="icon" href="/images/weldon-paints-logo.png" type="image/png">
  <link rel="stylesheet" href="/stylesheets/allProducts.css">
  
</head>
<body>
<h1>All Products</h1>

  <!-- ðŸ” Filter Section -->
 <form class="filter-container" method="GET" action="/products/all">
  <select name="filter" id="filter" onchange="toggleDateInputs(this.value)">
    <option value="all" <%= filter === 'all' ? 'selected' : '' %>>All Dates</option>
    <option value="today" <%= filter === 'today' ? 'selected' : '' %>>Today</option>
    <option value="yesterday" <%= filter === 'yesterday' ? 'selected' : '' %>>Yesterday</option>
    <option value="month" <%= filter === 'month' ? 'selected' : '' %>>This Month</option>
    <option value="lastMonth" <%= filter === 'lastMonth' ? 'selected' : '' %>>Last Month</option>
    <option value="custom" <%= filter === 'custom' ? 'selected' : '' %>>Custom Range</option>
  </select>

<!-- Brand Name Filter -->
  <select name="brand" id="brandFilter" onchange="this.form.submit()">
    <option value="all" <%= selectedBrand === 'all' ? 'selected' : '' %>>All Brands</option>
    <option value="Weldon Paints" <%= selectedBrand === 'Weldon Paints' ? 'selected' : '' %>>Weldon Paints</option>
    <option value="Sparco Paints" <%= selectedBrand === 'Sparco Paints' ? 'selected' : '' %>>Sparco Paints</option>
    <option value="Value Paints" <%= selectedBrand === 'Value Paints' ? 'selected' : '' %>>Value Paints</option>
    <option value="Other" <%= selectedBrand === 'Other' ? 'selected' : '' %>>Other</option>
  </select>


  <!-- Item Name Filter -->
<select name="itemName" id="itemNameFilter" onchange="this.form.submit()">
  <option value="all" <%= selectedItem === 'all' ? 'selected' : '' %>>All Items</option>
  <option value="Weather Shield" <%= selectedItem === 'Weather Shield' ? 'selected' : '' %>>Weather Shield</option>
  <option value="Emulsion" <%= selectedItem === 'Emulsion' ? 'selected' : '' %>>Emulsion</option>
  <option value="Enamel" <%= selectedItem === 'Enamel' ? 'selected' : '' %>>Enamel</option>
  <option value="Other" <%= selectedItem === 'Other' ? 'selected' : '' %>>Other</option>
</select>


<!-- Item Colour Filter -->
<select name="colourName" id="colourNameFilter" onchange="this.form.submit()">
  <option value="all" <%= selectedColour === 'all' ? 'selected' : '' %>>All Colours</option>
  <option value="Blue" <%= selectedColour === 'Blue' ? 'selected' : '' %>>Blue</option>
  <option value="Red" <%= selectedColour === 'Red' ? 'selected' : '' %>>Red</option>
  <option value="Green" <%= selectedColour === 'Green' ? 'selected' : '' %>>Green</option>
  <option value="Other" <%= selectedItem === 'Other' ? 'selected' : '' %>>Other</option>
</select>


<!-- Units Filter -->
<select name="unit" id="unitFilter" onchange="this.form.submit()">
  <option value="all" <%= selectedUnit === 'all' ? 'selected' : '' %>>All Units</option>
  <option value="Gallon" <%= selectedUnit === 'Gallon' ? 'selected' : '' %>>Gallon</option>
  <option value="Quarter" <%= selectedUnit === 'Quarter' ? 'selected' : '' %>>Quarter</option>
  <option value="Drum" <%= selectedUnit === 'Drum' ? 'selected' : '' %>>Drum</option>
  <option value="Liter" <%= selectedUnit === 'Liter' ? 'selected' : '' %>>Liter</option>
  <option value="Other" <%= selectedUnit === 'Other' ? 'selected' : '' %>>Other</option>
</select>


<!-- Stock Status Filter -->
  <select name="stockStatus" id="stockStatusFilter" onchange="this.form.submit()">
    <option value="all" <%= stockStatus === 'all' ? 'selected' : '' %>>All Stock</option>
    <option value="in" <%= stockStatus === 'in' ? 'selected' : '' %>>In Stock</option>
    <option value="out" <%= stockStatus === 'out' ? 'selected' : '' %>>Out of Stock</option>
  </select>


  <!-- Refund Status Filter -->
<select name="refund" id="refundFilter" onchange="this.form.submit()">
  <option value="all" <%= selectedRefund === 'all' ? 'selected' : '' %>>All Status</option>
  <option value="none" <%= selectedRefund === 'none' ? 'selected' : '' %>>Not Refunded</option>
  <option value="Partially Refunded" <%= selectedRefund === 'Partially Refunded' ? 'selected' : '' %>>Partially Refunded</option>
  <option value="Fully Refunded" <%= selectedRefund === 'Fully Refunded' ? 'selected' : '' %>>Fully Refunded</option>
</select>


  <input type="date" name="from" id="from" value="<%= from || '' %>" style="display:none;">
  <input type="date" name="to" id="to" value="<%= to || '' %>" style="display:none;">
  <button type="submit" id="apply">Apply</button>
</form>

  <!-- Stats -->
  <div class="stats">
    <div class="stat-box">
      <h3>Total Products</h3>
      <p><%= stats.totalStock || 0 %></p>
    </div>
    
    <div class="stat-box">
      <h3>Products Value</h3>
      <p>Rs <%= stats.totalValue ? stats.totalValue.toFixed(2) : '0.00' %></p>
    </div>

     <div class="stat-box">
      <h3>Items In Stock</h3>
      <p><%= stats.totalRemaining || 0 %></p>
    </div>

    <div class="stat-box">
      <h3>Remaining Stock Value</h3>
      <p><%= stats.remaining  ? stats.remaining.toFixed(2) : '0.00' %></p>
    </div>


<div class="stat-box">
  <h3>Refunded Stock Value</h3>
  <p id="refund-stock">Rs <%= stats.totalRefundedValue ? stats.totalRefundedValue.toFixed(2) : '0.00' %></p>
</div>

    
   
    
  </div>

  <!-- Product Table -->
  <table>
    <thead>
      <tr>
        <th>Stock ID</th>
        <th>Brand Name</th>
        <th>Item Name</th>
        <th>Item Colour</th>
        <th>Unit</th>
        <th>Total Product</th>
        <th>Remaining</th>
        <th>Rate</th>
        <th>Total Amount</th>
        <th>Status</th>
        <th>Refund (Qty)</th>
        <th>Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <% if (products.length === 0) { %>
        <tr><td colspan="6" class="no-data">No products found for the selected filter.</td></tr>
      <% } else { %>
        <% products.forEach(p => { %>
          <tr>
            <td><%= p.stockID %></td>
            <td><%= p.brandName %></td>
            <td><%= p.itemName %></td>
            <td><%= p.colourName %></td>
            <td><%= p.qty %></td>
            <td><%= p.totalProduct %></td>
            <td><%= p.remaining %></td>
            <td>Rs <%= p.rate %></td>
            <td>Rs <%= (p.totalProduct * p.rate).toFixed(2) %></td>
            <td class="refund-status"><%= p.refundStatus %></td>
            <td class="refund-quantity"><%= p.refundQuantity %></td>
            <td><%= new Date(p.createdAt).toLocaleDateString() %></td>
            <td><button onclick="deleteProduct('<%= p._id %>')" id="delete">Delete</button></td>
          </tr>
        <% }) %>
      <% } %>
    </tbody>
  </table>

  <script>



    function toggleDateInputs(value) {
      const from = document.getElementById("from");
      const to = document.getElementById("to");
      if (value === "custom") {
        from.style.display = "inline-block";
        to.style.display = "inline-block";
      } else {
        from.style.display = "none";
        to.style.display = "none";
      }
    }
    toggleDateInputs("<%= filter %>");





// Function to delete product 
    async function deleteProduct(productId) {
      const confirmDelete = confirm("Are you sure you want to delete this product?");
      if (confirmDelete) {
        try {
          const res = await fetch(`/products/delete-product/${productId}`, { method: "DELETE" });
          const data = await res.json();
          if (data.success) {
            alert("Product deleted successfully!");
            location.reload(); // Reload the page to reflect changes
          } else {
            alert("Failed to delete product");
          }
        } catch (err) {
          alert("Error deleting product");
        }
      }
    }


  </script>
</body>
</html>
